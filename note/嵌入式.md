# 可重入

- 所谓可重入是指一个可以被多个任务调用的过程，任务在调用时不必担心数据是否会出错。**一个可重入的函数简单来说就是可以被中断的函数，也就是说，可以在这个函数执行的任何时刻中断它，转入OS调度下去执行另外一段代码，而返回控制时不会出现什么错误；而不可重入的函数由于使用了一些系统资源，比如全局变量区，中断向量表等，所以它如果被中断的话，可能会出现问题，这类函数是不能运行在多任务环境下的。****也可以这样理解，重入即表示重复进入**，首先它意味着这个函数可以被中断，其次意味着它除了使用自己栈上的变量以外不依赖于任何环境（包括  static），这样的函数就是purecode（纯代码）可重入，可以允许有该函数的多个副本在运行，由于它们使用的是分离的栈，所以不会互相干扰。如果确实需要访问全局变量（包括 static），一定要注意实施互斥手段。可重入函数在并行运行环境中非常重要，但是一般要为访问全局变量付出一些性能代价。

# 内存四区

## 1.代码区

　　程序被操作系统加载到内存的时候，所有的可执行代码（程序代码指令、常量字符串等）都加载到代码区，这块内存在程序运行期间是不变的。代码区是平行的，里面装的就是一堆指令，在程序运行期间是不能改变的。函数也是代码的一部分，故函数都被放在代码区，包括main函数。

　　注意："int a = 0;"语句可拆分成"int a;"和"a = 0"，定义变量a的"int a;"语句并不是代码，它在程序编译时就执行了，并没有放到代码区，放到代码区的只有"a = 0"这句。

## 2.静态区

　　静态区存放程序中所有的全局变量和静态变量。

## 3.栈区

　　栈（stack）是一种先进后出的内存结构，所有的自动变量、函数形参都存储在栈中，这个动作由编译器自动完成，我们写程序时不需要考虑。栈区在程序运行期间是可以随时修改的。当一个自动变量超出其作用域时，自动从栈中弹出。

- 每个线程都有自己专属的栈；
- 栈的最大尺寸固定，超出则引起栈溢出；
- 变量离开作用域后栈上的内存会自动释放。

## 4.堆区

　　堆（heap）和栈一样，也是一种在程序运行过程中可以随时修改的内存区域，但没有栈那样先进后出的顺序。更重要的是堆是一个大容器，它的容量要远远大于栈，这可以解决上面实验三造成的内存溢出困难。一般比较复杂的数据类型都是放在堆中。但是在C语言中，堆内存空间的申请和释放需要手动通过代码来完成。对于一个32位操作系统，最大管理管理4G内存，其中1G是给操作系统自己用的，剩下的3G都是给用户程序，一个用户程序理论上可以使用3G的内存空间。堆上的内存必须手动释放（C/C++），除非语言执行环境支持GC（如C#在.NET上运行就有垃圾回收机制）。

# IIC

***IIC（Inter-Integrated Circuit）内部集成电路；多主机总线，非全双工***

还是假设A给B发数据（这里A.SCL接B.SCL, A.SDA接B.SDA）。起初SDA和SCL上的电平都为高电平。然后A先把SDA拉低，等SDA变为低电平后再把SCL拉低(以上两个动作构成了iic的起始位)，此时SDA就可以发送数据了，与此同时，SCL发送一定周期的脉冲（周期和PCLK有关，一般会在IIC的控制寄存器中设置）。SDA发送数据和SCL发送脉冲的要符合的关系是：SDA必须在SCL是高电平是保持有效，在SCL是低电平时发送下一位（SCL会在上升沿对SDA进行采样）。规定一次必须传8位数据，8位数据传输结束后A释放SDA，但SCL再发一个脉冲（这是第九个脉冲），这会触发B通过将SDA置为低电平表示确认（该低电平称为ACK）。最后SCL先变为高电平，SDA再变为高电平（以上两个动作称为结束标志）如果B没有将SDA置为0，则A停止发送下一帧数据。IIC总线（即SDA和SCL）上的每个设备都有唯一地址，数据包传输时先发送地址位，接着才是数据。一个地址字节由7个地址位（可以挂128个设备）和1个指示位组成（7位寻址模式）。指示位是0表示写，1表示读。还有10位寻址模式，使用两个字节来保存地址，第一个字节的最低两位和第二个字节的8位合起来构成10位地址。

- IIC数据从最高位开始传输。
- 用7bit表示从地址，那么可以挂载的从设备数是2的7次方128个。处理器想写的话：先发送起始位，再发一个8bit数据：前7bit表示从地址，第8bit表示读或者写。0write是处理器往IIC从设备发，1read是IIC从设备往处理器发。第9个时钟周期回复响应信号。

# SPI

***SPI(Serial Peripheral Interface)，串行外设接口。 由Motorola提出的全双工三线同步串行外围接口，采用主从模式（Master Slave）架构***

**Features**
  高速、全双工、同步通信、四线接口
**Pin**
  SCK：时钟信号 -> 主机产生，速率受限低速设备
  SS(CS/NSS)：片选 -> 低电平有效，同一时刻只允许一个设备连接
  MISO(SDI)：主设备输入/从设备输出
  MOSI(SDO)：主设备输出/从设备输入

